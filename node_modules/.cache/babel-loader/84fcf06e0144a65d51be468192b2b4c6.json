{"ast":null,"code":"var _jsxFileName = \"D:\\\\KA\\\\HOC HANH\\\\H\\u1ECCC L\\u1EACP TR\\xCCNH 2021\\\\FRONTEND64_20.03-27.09.2021\\\\Buoi33_17.07.2021_React-function\\\\Tro-choi-bai\\\\src\\\\components\\\\Control\\\\index.jsx\";\nimport React, { useCallback } from \"react\";\nimport axios from \"axios\";\nimport { useDispatch, useSelector, useStore } from \"react-redux\"; //dùng useStore khi cần lấy dữ liệu trên store xuống dùng mà component ko cần phải render lại, còn nếu component phải render lại thì dùng useSelector (do useSeclector đổi thì state của component cũng đổi nên phải render lại)\n\nconst Control = () => {\n  //Hàm useStore dùng để lấy dữ liệu về dùng mà ko thay đổi state của component như useSelector\n  // const store = useStore();\n  // store.getState()\n  const deckCard = useSelector(state => {\n    return state.card.deckCard;\n  });\n  const playList = useSelector(state => {\n    return state.player.playerList;\n  });\n  const dispatch = useDispatch();\n  const {\n    reveal,\n    shuffle,\n    draw\n  } = useSelector(state => state.card); //Draw cards:\n\n  const drawCards = useCallback(() => {\n    console.log(deckCard.deck_id);\n    axios({\n      method: \"GET\",\n      url: `http://deckofcardsapi.com/api/deck/${deckCard.deck_id}/draw/?count=12`\n    }).then(res => {\n      const players = [...playList]; //chia bài\n\n      for (const i in res.data.cards) {\n        const playerIndex = i % 4;\n        players[playerIndex].cards.push(res.data.cards[i]); //i = 0, playerIndex = 0 => card[0] => player[0]\n        //i = 1, playerIndex = 1 => card[1] => player[1]\n        //i = 2, playerIndex = 2 => card[2] => player[2]\n        //i = 3, playerIndex = 3 => card[3] => player[3]\n        //i = 4, playerIndex = 0 => card[4] => player[0]\n        //i = 5, playerIndex = 1 => card[5] => player[1]\n        //i = 6, playerIndex = 2 => card[6] => player[2]\n      }\n\n      dispatch({\n        type: \"SET_PLAYERS\",\n        payload: players\n      });\n      dispatch({\n        type: \"DRAW_CARDS\"\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  }, [deckCard, playList]); //Reveal cards:\n\n  const setPoint = (players, winnerList, gain, lose) => {\n    return players.map(player => {\n      let newItem = { ...player\n      };\n      let winner = winnerList.find(item => player.username === item.username);\n\n      if (winner) {\n        newItem.totalPoint = player.totalPoint + gain;\n      } else {\n        newItem.totalPoint = player.totalPoint - lose;\n      }\n\n      return newItem;\n    });\n  };\n\n  const revealCards = useCallback(() => {\n    //1. Lật bài\n    dispatch({\n      type: \"REVEAL_CARDS\"\n    }); //2. tính kết quả\n    //check playerList\n    //TH còn lại: cộng điểm người chơi, tìm max\n    //note: có thể có nhiều hơn 1 người thắng, danh sách người thắng phải là 1 cái mảng\n\n    let players = [...playList];\n    let winnerList = [{\n      username: \"\",\n      result: 0,\n      totalPoint: 25000\n    }];\n    const resultList = players.map(item => {\n      let resPlayerList = {}; //TH đặc biệt : King, Jack, Queen\n\n      let arrKJQCase = item.cards.filter(card => card.value === \"QUEEN\" || card.value === \"KING\" || card.value === \"JACK\"); //TH đặc biệt : 3 cào\n\n      let sameThreeCardCase = 0;\n      item.cards.reduce((preValue, currVal) => {\n        if (currVal.value === preValue.value) {\n          sameThreeCardCase += 1;\n        }\n\n        return currVal;\n      });\n\n      if (sameThreeCardCase === 2) {\n        resPlayerList = {\n          username: item.username,\n          result: 11,\n          totalPoint: item.totalPoint\n        };\n        return resPlayerList;\n      }\n\n      if (arrKJQCase.length === 3) {\n        resPlayerList = {\n          username: item.username,\n          result: 10,\n          totalPoint: item.totalPoint\n        };\n        return resPlayerList;\n      } else {\n        const point = item.cards.reduce((pointCard, card, index) => {\n          if (card.value === \"ACE\") {\n            card.value = 1;\n          }\n\n          if (card.value === \"QUEEN\" || card.value === \"KING\" || card.value === \"JACK\") {\n            card.value = 10;\n          }\n\n          pointCard += +card.value;\n          return pointCard;\n        }, 0);\n        resPlayerList = {\n          username: item.username,\n          result: point % 10,\n          totalPoint: item.totalPoint\n        };\n        return resPlayerList;\n      }\n    });\n\n    for (let player of resultList) {\n      if (player.result > winnerList[0].result) {\n        winnerList = [{ ...player\n        }];\n      }\n\n      if (player.result === winnerList[0].result) {\n        if (!winnerList.find(item => item.username === player.username)) {\n          winnerList.push(player);\n        }\n      }\n    }\n\n    switch (winnerList.length) {\n      case 1:\n        players = setPoint(players, winnerList, 3000, 1000);\n        break;\n\n      case 2:\n        players = setPoint(players, winnerList, 1000, 1000);\n        break;\n\n      case 3:\n        players = setPoint(players, winnerList, Math.round(1000 / 3), 1000);\n        break;\n\n      default:\n        players = setPoint(players, winnerList, 0, 0);\n        break;\n    } //3.Dispatch new playerList với new totalPoint\n\n\n    dispatch({\n      type: \"SET_PLAYERS\",\n      payload: players\n    });\n  }, [dispatch, setPoint]); //Shuffle cards:\n\n  const shuffleCards = () => {\n    // axios({\n    //   method: \"GET\",\n    //   url: \"http://deckofcardsapi.com/api/deck/new/\"\n    // })\n    //   .then((res) => {\n    //     dispatch({ type: \"SHUFFLE_CARDS\", payload: res.data });\n    //   })\n    //   .catch((err) => {\n    //     console.log(err);\n    //   });\n    const newDeckCard = { ...deckCard,\n      shuffled: true\n    };\n    dispatch({\n      type: \"SHUFFLE_CARDS\",\n      payload: newDeckCard\n    });\n    const players = playList.map(player => ({ ...player,\n      cards: []\n    }));\n    dispatch({\n      type: \"SET_PLAYERS\",\n      payload: players\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex  justify-content-end container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"border d-flex justify-content-center align-items-center px-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-success mr-2\",\n    disabled: !shuffle,\n    onClick: shuffleCards,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 9\n    }\n  }, \"Shuffle\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-info mr-2\",\n    onClick: drawCards,\n    disabled: !draw,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 9\n    }\n  }, \"Draw\"), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn btn-primary mr-2\",\n    onClick: revealCards,\n    disabled: !reveal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }\n  }, \"Reveal\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 7\n    }\n  }, playList.map(item => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: item.username,\n      className: \"border px-3 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 15\n      }\n    }, item.username), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 15\n      }\n    }, \" \", item.totalPoint, \" \"));\n  })));\n};\n\nexport default Control;","map":{"version":3,"sources":["D:/KA/HOC HANH/HỌC LẬP TRÌNH 2021/FRONTEND64_20.03-27.09.2021/Buoi33_17.07.2021_React-function/Tro-choi-bai/src/components/Control/index.jsx"],"names":["React","useCallback","axios","useDispatch","useSelector","useStore","Control","deckCard","state","card","playList","player","playerList","dispatch","reveal","shuffle","draw","drawCards","console","log","deck_id","method","url","then","res","players","i","data","cards","playerIndex","push","type","payload","catch","err","setPoint","winnerList","gain","lose","map","newItem","winner","find","item","username","totalPoint","revealCards","result","resultList","resPlayerList","arrKJQCase","filter","value","sameThreeCardCase","reduce","preValue","currVal","length","point","pointCard","index","Math","round","shuffleCards","newDeckCard","shuffled"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,WAAhB,QAAmC,OAAnC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,WAAT,EAAsBC,WAAtB,EAAmCC,QAAnC,QAAmD,aAAnD,C,CAAkE;;AAElE,MAAMC,OAAO,GAAG,MAAM;AACpB;AACA;AACA;AAEA,QAAMC,QAAQ,GAAGH,WAAW,CAAEI,KAAD,IAAW;AACtC,WAAOA,KAAK,CAACC,IAAN,CAAWF,QAAlB;AACD,GAF2B,CAA5B;AAIA,QAAMG,QAAQ,GAAGN,WAAW,CAAEI,KAAD,IAAW;AACtC,WAAOA,KAAK,CAACG,MAAN,CAAaC,UAApB;AACD,GAF2B,CAA5B;AAGA,QAAMC,QAAQ,GAAGV,WAAW,EAA5B;AAEA,QAAM;AAAEW,IAAAA,MAAF;AAAUC,IAAAA,OAAV;AAAmBC,IAAAA;AAAnB,MAA4BZ,WAAW,CAAEI,KAAD,IAAWA,KAAK,CAACC,IAAlB,CAA7C,CAdoB,CAgBpB;;AACA,QAAMQ,SAAS,GAAGhB,WAAW,CAAC,MAAM;AAClCiB,IAAAA,OAAO,CAACC,GAAR,CAAYZ,QAAQ,CAACa,OAArB;AACAlB,IAAAA,KAAK,CAAC;AACJmB,MAAAA,MAAM,EAAE,KADJ;AAEJC,MAAAA,GAAG,EAAG,sCAAqCf,QAAQ,CAACa,OAAQ;AAFxD,KAAD,CAAL,CAIGG,IAJH,CAISC,GAAD,IAAS;AACb,YAAMC,OAAO,GAAG,CAAC,GAAGf,QAAJ,CAAhB,CADa,CAEb;;AACA,WAAK,MAAMgB,CAAX,IAAgBF,GAAG,CAACG,IAAJ,CAASC,KAAzB,EAAgC;AAC9B,cAAMC,WAAW,GAAGH,CAAC,GAAG,CAAxB;AACAD,QAAAA,OAAO,CAACI,WAAD,CAAP,CAAqBD,KAArB,CAA2BE,IAA3B,CAAgCN,GAAG,CAACG,IAAJ,CAASC,KAAT,CAAeF,CAAf,CAAhC,EAF8B,CAI9B;AACA;AACA;AACA;AACA;AACA;AACA;AACD;;AACDb,MAAAA,QAAQ,CAAC;AAAEkB,QAAAA,IAAI,EAAE,aAAR;AAAuBC,QAAAA,OAAO,EAAEP;AAAhC,OAAD,CAAR;AACAZ,MAAAA,QAAQ,CAAC;AAAEkB,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAR;AACD,KArBH,EAsBGE,KAtBH,CAsBUC,GAAD,IAAS;AACdhB,MAAAA,OAAO,CAACC,GAAR,CAAYe,GAAZ;AACD,KAxBH;AAyBD,GA3B4B,EA2B1B,CAAC3B,QAAD,EAAWG,QAAX,CA3B0B,CAA7B,CAjBoB,CA8CpB;;AACA,QAAMyB,QAAQ,GAAG,CAACV,OAAD,EAAUW,UAAV,EAAsBC,IAAtB,EAA4BC,IAA5B,KAAqC;AACpD,WAAOb,OAAO,CAACc,GAAR,CAAa5B,MAAD,IAAY;AAC7B,UAAI6B,OAAO,GAAG,EAAE,GAAG7B;AAAL,OAAd;AAEA,UAAI8B,MAAM,GAAGL,UAAU,CAACM,IAAX,CAAiBC,IAAD,IAAUhC,MAAM,CAACiC,QAAP,KAAoBD,IAAI,CAACC,QAAnD,CAAb;;AAEA,UAAIH,MAAJ,EAAY;AACVD,QAAAA,OAAO,CAACK,UAAR,GAAqBlC,MAAM,CAACkC,UAAP,GAAoBR,IAAzC;AACD,OAFD,MAEO;AACLG,QAAAA,OAAO,CAACK,UAAR,GAAqBlC,MAAM,CAACkC,UAAP,GAAoBP,IAAzC;AACD;;AACD,aAAOE,OAAP;AACD,KAXM,CAAP;AAYD,GAbD;;AAeA,QAAMM,WAAW,GAAG7C,WAAW,CAAC,MAAM;AACpC;AACAY,IAAAA,QAAQ,CAAC;AAAEkB,MAAAA,IAAI,EAAE;AAAR,KAAD,CAAR,CAFoC,CAGpC;AACA;AAEA;AACA;;AACA,QAAIN,OAAO,GAAG,CAAC,GAAGf,QAAJ,CAAd;AACA,QAAI0B,UAAU,GAAG,CAAC;AAAEQ,MAAAA,QAAQ,EAAE,EAAZ;AAAgBG,MAAAA,MAAM,EAAE,CAAxB;AAA2BF,MAAAA,UAAU,EAAE;AAAvC,KAAD,CAAjB;AAEA,UAAMG,UAAU,GAAGvB,OAAO,CAACc,GAAR,CAAaI,IAAD,IAAU;AACvC,UAAIM,aAAa,GAAG,EAApB,CADuC,CAEvC;;AACA,UAAIC,UAAU,GAAGP,IAAI,CAACf,KAAL,CAAWuB,MAAX,CACd1C,IAAD,IACEA,IAAI,CAAC2C,KAAL,KAAe,OAAf,IACA3C,IAAI,CAAC2C,KAAL,KAAe,MADf,IAEA3C,IAAI,CAAC2C,KAAL,KAAe,MAJF,CAAjB,CAHuC,CASvC;;AACA,UAAIC,iBAAiB,GAAG,CAAxB;AACAV,MAAAA,IAAI,CAACf,KAAL,CAAW0B,MAAX,CAAkB,CAACC,QAAD,EAAWC,OAAX,KAAuB;AACvC,YAAIA,OAAO,CAACJ,KAAR,KAAkBG,QAAQ,CAACH,KAA/B,EAAsC;AACpCC,UAAAA,iBAAiB,IAAI,CAArB;AACD;;AACD,eAAOG,OAAP;AACD,OALD;;AAMA,UAAIH,iBAAiB,KAAK,CAA1B,EAA6B;AAC3BJ,QAAAA,aAAa,GAAG;AACdL,UAAAA,QAAQ,EAAED,IAAI,CAACC,QADD;AAEdG,UAAAA,MAAM,EAAE,EAFM;AAGdF,UAAAA,UAAU,EAAEF,IAAI,CAACE;AAHH,SAAhB;AAKA,eAAOI,aAAP;AACD;;AACD,UAAIC,UAAU,CAACO,MAAX,KAAsB,CAA1B,EAA6B;AAC3BR,QAAAA,aAAa,GAAG;AACdL,UAAAA,QAAQ,EAAED,IAAI,CAACC,QADD;AAEdG,UAAAA,MAAM,EAAE,EAFM;AAGdF,UAAAA,UAAU,EAAEF,IAAI,CAACE;AAHH,SAAhB;AAKA,eAAOI,aAAP;AACD,OAPD,MAOO;AACL,cAAMS,KAAK,GAAGf,IAAI,CAACf,KAAL,CAAW0B,MAAX,CAAkB,CAACK,SAAD,EAAYlD,IAAZ,EAAkBmD,KAAlB,KAA4B;AAC1D,cAAInD,IAAI,CAAC2C,KAAL,KAAe,KAAnB,EAA0B;AACxB3C,YAAAA,IAAI,CAAC2C,KAAL,GAAa,CAAb;AACD;;AACD,cACE3C,IAAI,CAAC2C,KAAL,KAAe,OAAf,IACA3C,IAAI,CAAC2C,KAAL,KAAe,MADf,IAEA3C,IAAI,CAAC2C,KAAL,KAAe,MAHjB,EAIE;AACA3C,YAAAA,IAAI,CAAC2C,KAAL,GAAa,EAAb;AACD;;AAEDO,UAAAA,SAAS,IAAI,CAAClD,IAAI,CAAC2C,KAAnB;AACA,iBAAOO,SAAP;AACD,SAda,EAcX,CAdW,CAAd;AAgBAV,QAAAA,aAAa,GAAG;AACdL,UAAAA,QAAQ,EAAED,IAAI,CAACC,QADD;AAEdG,UAAAA,MAAM,EAAEW,KAAK,GAAG,EAFF;AAGdb,UAAAA,UAAU,EAAEF,IAAI,CAACE;AAHH,SAAhB;AAKA,eAAOI,aAAP;AACD;AACF,KAxDkB,CAAnB;;AA0DA,SAAK,IAAItC,MAAT,IAAmBqC,UAAnB,EAA+B;AAC7B,UAAIrC,MAAM,CAACoC,MAAP,GAAgBX,UAAU,CAAC,CAAD,CAAV,CAAcW,MAAlC,EAA0C;AACxCX,QAAAA,UAAU,GAAG,CAAC,EAAE,GAAGzB;AAAL,SAAD,CAAb;AACD;;AACD,UAAIA,MAAM,CAACoC,MAAP,KAAkBX,UAAU,CAAC,CAAD,CAAV,CAAcW,MAApC,EAA4C;AAC1C,YAAI,CAACX,UAAU,CAACM,IAAX,CAAiBC,IAAD,IAAUA,IAAI,CAACC,QAAL,KAAkBjC,MAAM,CAACiC,QAAnD,CAAL,EAAmE;AACjER,UAAAA,UAAU,CAACN,IAAX,CAAgBnB,MAAhB;AACD;AACF;AACF;;AACD,YAAQyB,UAAU,CAACqB,MAAnB;AACE,WAAK,CAAL;AACEhC,QAAAA,OAAO,GAAGU,QAAQ,CAACV,OAAD,EAAUW,UAAV,EAAsB,IAAtB,EAA4B,IAA5B,CAAlB;AACA;;AACF,WAAK,CAAL;AACEX,QAAAA,OAAO,GAAGU,QAAQ,CAACV,OAAD,EAAUW,UAAV,EAAsB,IAAtB,EAA4B,IAA5B,CAAlB;AACA;;AACF,WAAK,CAAL;AACEX,QAAAA,OAAO,GAAGU,QAAQ,CAACV,OAAD,EAAUW,UAAV,EAAsByB,IAAI,CAACC,KAAL,CAAW,OAAO,CAAlB,CAAtB,EAA4C,IAA5C,CAAlB;AACA;;AACF;AACErC,QAAAA,OAAO,GAAGU,QAAQ,CAACV,OAAD,EAAUW,UAAV,EAAsB,CAAtB,EAAyB,CAAzB,CAAlB;AACA;AAZJ,KA/EoC,CA6FpC;;;AACAvB,IAAAA,QAAQ,CAAC;AAAEkB,MAAAA,IAAI,EAAE,aAAR;AAAuBC,MAAAA,OAAO,EAAEP;AAAhC,KAAD,CAAR;AACD,GA/F8B,EA+F5B,CAACZ,QAAD,EAAWsB,QAAX,CA/F4B,CAA/B,CA9DoB,CA+JpB;;AAEA,QAAM4B,YAAY,GAAG,MAAM;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAMC,WAAW,GAAG,EAAC,GAAGzD,QAAJ;AAAc0D,MAAAA,QAAQ,EAAE;AAAxB,KAApB;AACApD,IAAAA,QAAQ,CAAC;AAACkB,MAAAA,IAAI,EAAE,eAAP;AAAwBC,MAAAA,OAAO,EAAEgC;AAAjC,KAAD,CAAR;AACA,UAAMvC,OAAO,GAAGf,QAAQ,CAAC6B,GAAT,CAAc5B,MAAD,KAAa,EAAE,GAAGA,MAAL;AAAaiB,MAAAA,KAAK,EAAE;AAApB,KAAb,CAAb,CAAhB;AAEAf,IAAAA,QAAQ,CAAC;AAAEkB,MAAAA,IAAI,EAAE,aAAR;AAAuBC,MAAAA,OAAO,EAAEP;AAAhC,KAAD,CAAR;AACD,GAhBD;;AAkBA,sBACE;AAAK,IAAA,SAAS,EAAC,uCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,SAAS,EAAC,8DAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAQ,IAAA,SAAS,EAAC,sBAAlB;AAAyC,IAAA,QAAQ,EAAE,CAACV,OAApD;AAA6D,IAAA,OAAO,EAAEgD,YAAtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,eAIE;AACE,IAAA,SAAS,EAAC,mBADZ;AAEE,IAAA,OAAO,EAAE9C,SAFX;AAGE,IAAA,QAAQ,EAAE,CAACD,IAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAJF,eAWE;AACE,IAAA,SAAS,EAAC,sBADZ;AAEE,IAAA,OAAO,EAAE8B,WAFX;AAGE,IAAA,QAAQ,EAAE,CAAChC,MAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAXF,CADF,eAoBE;AAAK,IAAA,SAAS,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGJ,QAAQ,CAAC6B,GAAT,CAAcI,IAAD,IAAU;AACtB,wBACE;AAAK,MAAA,GAAG,EAAEA,IAAI,CAACC,QAAf;AAAyB,MAAA,SAAS,EAAC,yBAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAID,IAAI,CAACC,QAAT,CADF,eAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAKD,IAAI,CAACE,UAAV,MAFF,CADF;AAMD,GAPA,CADH,CApBF,CADF;AAiCD,CApND;;AAsNA,eAAevC,OAAf","sourcesContent":["import React, { useCallback } from \"react\";\r\nimport axios from \"axios\";\r\nimport { useDispatch, useSelector, useStore } from \"react-redux\"; //dùng useStore khi cần lấy dữ liệu trên store xuống dùng mà component ko cần phải render lại, còn nếu component phải render lại thì dùng useSelector (do useSeclector đổi thì state của component cũng đổi nên phải render lại)\r\n\r\nconst Control = () => {\r\n  //Hàm useStore dùng để lấy dữ liệu về dùng mà ko thay đổi state của component như useSelector\r\n  // const store = useStore();\r\n  // store.getState()\r\n\r\n  const deckCard = useSelector((state) => {\r\n    return state.card.deckCard;\r\n  });\r\n\r\n  const playList = useSelector((state) => {\r\n    return state.player.playerList;\r\n  });\r\n  const dispatch = useDispatch();\r\n\r\n  const { reveal, shuffle, draw } = useSelector((state) => state.card);\r\n\r\n  //Draw cards:\r\n  const drawCards = useCallback(() => {\r\n    console.log(deckCard.deck_id);\r\n    axios({\r\n      method: \"GET\",\r\n      url: `http://deckofcardsapi.com/api/deck/${deckCard.deck_id}/draw/?count=12`\r\n    })\r\n      .then((res) => {\r\n        const players = [...playList];\r\n        //chia bài\r\n        for (const i in res.data.cards) {\r\n          const playerIndex = i % 4;\r\n          players[playerIndex].cards.push(res.data.cards[i]);\r\n\r\n          //i = 0, playerIndex = 0 => card[0] => player[0]\r\n          //i = 1, playerIndex = 1 => card[1] => player[1]\r\n          //i = 2, playerIndex = 2 => card[2] => player[2]\r\n          //i = 3, playerIndex = 3 => card[3] => player[3]\r\n          //i = 4, playerIndex = 0 => card[4] => player[0]\r\n          //i = 5, playerIndex = 1 => card[5] => player[1]\r\n          //i = 6, playerIndex = 2 => card[6] => player[2]\r\n        }\r\n        dispatch({ type: \"SET_PLAYERS\", payload: players });\r\n        dispatch({ type: \"DRAW_CARDS\" });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }, [deckCard, playList]);\r\n\r\n  //Reveal cards:\r\n  const setPoint = (players, winnerList, gain, lose) => {\r\n    return players.map((player) => {\r\n      let newItem = { ...player };\r\n\r\n      let winner = winnerList.find((item) => player.username === item.username);\r\n\r\n      if (winner) {\r\n        newItem.totalPoint = player.totalPoint + gain;\r\n      } else {\r\n        newItem.totalPoint = player.totalPoint - lose;\r\n      }\r\n      return newItem;\r\n    });\r\n  };\r\n\r\n  const revealCards = useCallback(() => {\r\n    //1. Lật bài\r\n    dispatch({ type: \"REVEAL_CARDS\" });\r\n    //2. tính kết quả\r\n    //check playerList\r\n\r\n    //TH còn lại: cộng điểm người chơi, tìm max\r\n    //note: có thể có nhiều hơn 1 người thắng, danh sách người thắng phải là 1 cái mảng\r\n    let players = [...playList];\r\n    let winnerList = [{ username: \"\", result: 0, totalPoint: 25000 }];\r\n\r\n    const resultList = players.map((item) => {\r\n      let resPlayerList = {};\r\n      //TH đặc biệt : King, Jack, Queen\r\n      let arrKJQCase = item.cards.filter(\r\n        (card) =>\r\n          card.value === \"QUEEN\" ||\r\n          card.value === \"KING\" ||\r\n          card.value === \"JACK\"\r\n      );\r\n      //TH đặc biệt : 3 cào\r\n      let sameThreeCardCase = 0;\r\n      item.cards.reduce((preValue, currVal) => {\r\n        if (currVal.value === preValue.value) {\r\n          sameThreeCardCase += 1;\r\n        }\r\n        return currVal;\r\n      });\r\n      if (sameThreeCardCase === 2) {\r\n        resPlayerList = {\r\n          username: item.username,\r\n          result: 11,\r\n          totalPoint: item.totalPoint\r\n        };\r\n        return resPlayerList;\r\n      }\r\n      if (arrKJQCase.length === 3) {\r\n        resPlayerList = {\r\n          username: item.username,\r\n          result: 10,\r\n          totalPoint: item.totalPoint\r\n        };\r\n        return resPlayerList;\r\n      } else {\r\n        const point = item.cards.reduce((pointCard, card, index) => {\r\n          if (card.value === \"ACE\") {\r\n            card.value = 1;\r\n          }\r\n          if (\r\n            card.value === \"QUEEN\" ||\r\n            card.value === \"KING\" ||\r\n            card.value === \"JACK\"\r\n          ) {\r\n            card.value = 10;\r\n          }\r\n\r\n          pointCard += +card.value;\r\n          return pointCard;\r\n        }, 0);\r\n\r\n        resPlayerList = {\r\n          username: item.username,\r\n          result: point % 10,\r\n          totalPoint: item.totalPoint\r\n        };\r\n        return resPlayerList;\r\n      }\r\n    });\r\n\r\n    for (let player of resultList) {\r\n      if (player.result > winnerList[0].result) {\r\n        winnerList = [{ ...player }];\r\n      }\r\n      if (player.result === winnerList[0].result) {\r\n        if (!winnerList.find((item) => item.username === player.username)) {\r\n          winnerList.push(player);\r\n        }\r\n      }\r\n    }\r\n    switch (winnerList.length) {\r\n      case 1:\r\n        players = setPoint(players, winnerList, 3000, 1000);\r\n        break;\r\n      case 2:\r\n        players = setPoint(players, winnerList, 1000, 1000);\r\n        break;\r\n      case 3:\r\n        players = setPoint(players, winnerList, Math.round(1000 / 3), 1000);\r\n        break;\r\n      default:\r\n        players = setPoint(players, winnerList, 0, 0);\r\n        break;\r\n    }\r\n    //3.Dispatch new playerList với new totalPoint\r\n    dispatch({ type: \"SET_PLAYERS\", payload: players });\r\n  }, [dispatch, setPoint]);\r\n\r\n  //Shuffle cards:\r\n\r\n  const shuffleCards = () => {\r\n    // axios({\r\n    //   method: \"GET\",\r\n    //   url: \"http://deckofcardsapi.com/api/deck/new/\"\r\n    // })\r\n    //   .then((res) => {\r\n    //     dispatch({ type: \"SHUFFLE_CARDS\", payload: res.data });\r\n    //   })\r\n    //   .catch((err) => {\r\n    //     console.log(err);\r\n    //   });\r\n    const newDeckCard = {...deckCard, shuffled: true }\r\n    dispatch({type: \"SHUFFLE_CARDS\", payload: newDeckCard })\r\n    const players = playList.map((player) => ({ ...player, cards: [] }));\r\n\r\n    dispatch({ type: \"SET_PLAYERS\", payload: players });\r\n  };\r\n\r\n  return (\r\n    <div className=\"d-flex  justify-content-end container\">\r\n      <div className=\"border d-flex justify-content-center align-items-center px-2\">\r\n        <button className=\"btn btn-success mr-2\" disabled={!shuffle} onClick={shuffleCards}>\r\n          Shuffle\r\n        </button>\r\n        <button\r\n          className=\"btn btn-info mr-2\"\r\n          onClick={drawCards}\r\n          disabled={!draw}\r\n        >\r\n          Draw\r\n        </button>\r\n        <button\r\n          className=\"btn btn-primary mr-2\"\r\n          onClick={revealCards}\r\n          disabled={!reveal}\r\n        >\r\n          Reveal\r\n        </button>\r\n      </div>\r\n      <div className=\"d-flex\">\r\n        {playList.map((item) => {\r\n          return (\r\n            <div key={item.username} className=\"border px-3 text-center\">\r\n              <p>{item.username}</p>\r\n              <p> {item.totalPoint} </p>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Control;\r\n"]},"metadata":{},"sourceType":"module"}